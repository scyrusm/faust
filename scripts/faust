#! /usr/bin/env python

import click
import faust
import pkg_resources


@click.group()
@click.version_option(version=pkg_resources.require("faust")[0].version)
def cli():
    """FAUST (the FITS Algorithms for UMI-based Screens of T cells) is a set of tools for analyzing T cell CRISPR screen data.  Let's get FITS!  
    """


@cli.command(
    help=
    "Reads Gene Perturbation Platform (GPP) output and aggregates into a count matrix"
)
@click.argument('sgrna_input', type=click.Path(exists=True), nargs=1)
@click.argument('barcode_input', type=click.Path(exists=True), nargs=1)
@click.argument('prefix', nargs=1)
@click.argument('valid_constructs', type=click.Path(exists=True), nargs=1)
@click.argument('valid_umis', type=click.Path(exists=True), nargs=1)
@click.argument('conditions', type=click.Path(exists=True), nargs=1)
@click.argument('output', type=click.Path(exists=False), nargs=1)
@click.argument('quality_output', nargs=1)
def count(sgrna_input, barcode_input, prefix, valid_constructs, valid_umis, conditions,
          output, quality_output):
    from faust.utilities import count_gpp_output
    count_gpp_output(sgrna_input, barcode_input, prefix, valid_constructs, valid_umis,
                     conditions, output, quality_output)


if __name__ == '__main__':
    cli()
